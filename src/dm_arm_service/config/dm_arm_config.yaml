# ====================================
#   DM Arm 服务器配置文件
# ====================================

# ==================== 服务器配置 ==================== #
server:
  num_threads: 12                   # 异步处理线程数
  timeout_hardware: 20.0            # 等待硬件接口超时时间（秒）
  timeout_moveit: 20.0              # 等待 MoveIt 超时时间（秒）

# ==================== 硬件接口配置 ==================== #
hardware:
  serial_port: "/dev/ttyACM0"       # 串口设备
  baudrate: 921600                  # 波特率
  control_frequency: 500.0          # 控制频率（Hz）
  
  # 控制模式
  use_mit_mode: false               # 是否使用 MIT 模式
  kp: 30.0                          # MIT 模式比例增益
  kd: 1.0                           # MIT 模式微分增益
  
  # 安全参数
  max_position_change: 0.5          # 单次最大位置变化（rad）
  max_velocity: 5.0                 # 最大速度（rad/s）
  enable_write: true                # 是否启用写入

# ==================== 关节配置 ==================== #
joints:
  names:
    - joint1
    - joint2
    - joint3
    - joint4
    - joint5
    - joint6
  
  motor_ids: [1, 2, 3, 4, 5, 6]     # 电机 ID
  motor_types: [2, 2, 2, 0, 0, 0]   # 电机类型
  
  # 关节限位
  limits:
    joint1: {min: -3.14, max: 3.14}
    joint2: {min: -1.57, max: 1.57}
    joint3: {min: -1.57, max: 1.57}
    joint4: {min: -3.14, max: 3.14}
    joint5: {min: -1.57, max: 1.57}
    joint6: {min: -3.14, max: 3.14}

# ==================== 末端执行器配置 ==================== #
end_effector:
  max_reach: 0.6                    # 最大工作半径（米）
  min_reach: 0.1                    # 最小工作半径（米）
  
  # 位姿搜索参数
  search:
    step: 5.0                       # 搜索步长（度）
    radius: 45.0                    # 搜索半径（度）
    max_iterations: 100             # 最大迭代次数
  
  # 运动参数
  velocity_scaling: 0.3             # 速度缩放因子
  acceleration_scaling: 0.3         # 加速度缩放因子
  
  # 容差
  goal_position_tolerance: 0.015    # 位置目标容差（米）
  goal_orientation_tolerance: 0.05  # 姿态目标容差（弧度）

# ==================== 任务规划器配置 ==================== #
task_planner:
  enable_optimization: true         # 是否启用路径优化
  optimization_method: "greedy"     # 优化方法：greedy/tsp
  
  # 动作参数
  pick_height_offset: 0.1           # 抓取高度偏移（米）
  place_height_offset: 0.1          # 放置高度偏移（米）
  approach_distance: 0.05           # 接近距离（米）
  retreat_distance: 0.05            # 撤退距离（米）
  
  # 时间参数
  default_wait_time: 0.5            # 默认等待时间（秒）
  gripper_action_time: 1.0          # 夹爪动作时间（秒）

# ==================== MoveIt 配置 ==================== #
moveit:
  planning_group: "arm"             # 规划组名称
  planner_id: "RRTConnect"          # 规划器 ID
  planning_time: 5.0                # 规划时间限制（秒）
  num_planning_attempts: 10         # 规划尝试次数
  
  # 轨迹执行
  execution_timeout: 15.0           # 执行超时（秒）
  allow_replanning: true            # 允许重新规划
  
  # 工作空间边界
  workspace:
    min_corner: {x: -0.8, y: -0.8, z: 0.0}
    max_corner: {x: 0.8, y: 0.8, z: 1.0}

# ==================== 控制器配置 ==================== #
controllers:
  joint_state_controller:
    type: joint_state_controller/JointStateController
    publish_rate: 50
  
  arm_controller:
    type: position_controllers/JointTrajectoryController
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
      - joint5
      - joint6
    
    constraints:
      goal_time: 0.8
      stopped_velocity_tolerance: 0.05
      joint1: {trajectory: 0.2, goal: 0.05}
      joint2: {trajectory: 0.3, goal: 0.05}
      joint3: {trajectory: 0.2, goal: 0.05}
      joint4: {trajectory: 0.2, goal: 0.05}
      joint5: {trajectory: 0.2, goal: 0.05}
      joint6: {trajectory: 0.2, goal: 0.05}

# ==================== 安全配置 ==================== #
safety:
  enable_collision_check: true      # 启用碰撞检查
  enable_joint_limits: true         # 启用关节限位检查
  enable_self_collision: true       # 启用自碰撞检查
  
  # 紧急停止
  emergency_stop_topic: "/emergency_stop"
  emergency_stop_timeout: 0.1       # 紧急停止超时（秒）

# ==================== 日志配置 ==================== #
logging:
  level: "info"                     # 日志级别：debug/info/warn/error
  log_to_file: false                # 是否记录到文件
  log_file_path: "/tmp/dm_arm.log"  # 日志文件路径
  
# ==================== 调试配置 ==================== #
debug:
  visualize_trajectory: true        # 可视化轨迹
  print_joint_states: false         # 打印关节状态
  print_timing: false               # 打印时间统计
